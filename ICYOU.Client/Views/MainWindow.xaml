<Window x:Class="ICYOU.Client.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ICYOU.Client.Converters"
        Title="ICYOU Messenger" 
        Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Closing="Window_Closing">
    
    <Window.Resources>
        <conv:MessageContentConverter x:Key="MessageContentConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Ð›ÐµÐ²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ - Ñ‡Ð°Ñ‚Ñ‹ -->
        <Border Background="{StaticResource SurfaceBrush}" CornerRadius="0,16,16,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                <Border Padding="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock x:Name="UserDisplayName" 
                                       Text="ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ" 
                                       FontSize="16" 
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextBrush}"/>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" Fill="{StaticResource OnlineBrush}" Margin="0,0,6,0"/>
                                <TextBlock Text="Ð’ ÑÐµÑ‚Ð¸" 
                                           FontSize="12" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                        <Button Grid.Column="1" 
                                Style="{StaticResource IconButton}"
                                Click="SettingsButton_Click"
                                ToolTip="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸">
                            <TextBlock Text="âš™" FontSize="18"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- ÐŸÐ¾Ð¸ÑÐº -->
                <Border Grid.Row="1" Padding="12,0,12,12">
                    <TextBox x:Name="SearchBox" 
                             Style="{StaticResource ModernTextBox}"
                             Text=""
                             Tag="ÐŸÐ¾Ð¸ÑÐº..."
                             TextChanged="SearchBox_TextChanged"/>
                </Border>
                
                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‡Ð°Ñ‚Ð¾Ð² Ð¸ Ð´Ñ€ÑƒÐ·ÐµÐ¹ -->
                <Grid Grid.Row="2">
                    <!-- ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ° ÐºÐ¾Ð³Ð´Ð° Ð¿ÑƒÑÑ‚Ð¾ -->
                    <StackPanel x:Name="EmptyListHint" 
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center"
                                Visibility="Collapsed">
                        <TextBlock Text="Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿ÑƒÑÑ‚" 
                                   FontSize="14"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð´Ñ€ÑƒÐ·ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ·" 
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,5,0,0"/>
                        <TextBlock Text="ÐºÐ½Ð¾Ð¿ÐºÑƒ 'Ð”Ñ€ÑƒÐ·ÑŒÑ'" 
                                   FontSize="12"
                                   Foreground="{StaticResource AccentBrush}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <ListBox x:Name="ChatsList" 
                             Style="{StaticResource ChatListBox}"
                             ItemContainerStyle="{StaticResource ChatListBoxItem}"
                             SelectionChanged="ChatsList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="44"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- ÐÐ²Ð°Ñ‚Ð°Ñ€ Ñ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð¼ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° -->
                                <Grid Width="40" Height="40">
                                    <Border Width="40" Height="40" CornerRadius="20" Background="{StaticResource PrimaryBrush}">
                                        <TextBlock Text="{Binding AvatarLetter}" 
                                                   FontSize="16" 
                                                   FontWeight="Bold"
                                                   Foreground="White"
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð¾Ð½Ð»Ð°Ð¹Ð½ Ð´Ð»Ñ Ð´Ñ€ÑƒÐ·ÐµÐ¹ -->
                                    <Ellipse Width="12" Height="12" 
                                             Fill="{Binding StatusIndicator}"
                                             Stroke="{StaticResource SurfaceBrush}"
                                             StrokeThickness="2"
                                             HorizontalAlignment="Right"
                                             VerticalAlignment="Bottom"
                                             Visibility="{Binding StatusVisibility}"/>
                                </Grid>
                                
                                <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ -->
                                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock x:Name="NameText"
                                               Text="{Binding DisplayName}" 
                                               FontSize="14"/>
                                    <TextBlock x:Name="PreviewText"
                                               Text="{Binding LastMessagePreview}" 
                                               FontSize="12" 
                                               Opacity="0.7"
                                               TextTrimming="CharacterEllipsis"
                                               MaxWidth="150"/>
                                </StackPanel>
                                
                                <!-- ÐÐµÐ¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ðµ -->
                                <Border Grid.Column="2" 
                                        Background="{StaticResource AccentBrush}"
                                        CornerRadius="10"
                                        Padding="6,2"
                                        Visibility="{Binding UnreadVisibility}"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding UnreadCount}" 
                                               FontSize="11" 
                                               Foreground="White"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
                
                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð²Ð½Ð¸Ð·Ñƒ -->
                <Border Grid.Row="3" Padding="12" BorderThickness="0,1,0,0" BorderBrush="#404040">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Content="+ Ð§Ð°Ñ‚" 
                                Style="{StaticResource SecondaryButton}"
                                Click="NewChatButton_Click"
                                Margin="0,0,6,0"/>
                        <Button Grid.Column="1" 
                                Content="Ð”Ñ€ÑƒÐ·ÑŒÑ" 
                                Style="{StaticResource SecondaryButton}"
                                Click="FriendsButton_Click"
                                Margin="6,0,0,0"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- ÐŸÑ€Ð°Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ - ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
        <Grid Grid.Column="1" Margin="16,16,16,16">
            <!-- ÐŸÑƒÑÑ‚Ð¾Ð¹ Ñ‡Ð°Ñ‚ -->
            <Border x:Name="EmptyChatPanel" Visibility="Visible">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ’¬" FontSize="64" HorizontalAlignment="Center"/>
                    <TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‡Ð°Ñ‚" 
                               FontSize="18" 
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,16,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚ -->
            <Grid x:Name="ActiveChatPanel" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ñ‡Ð°Ñ‚Ð° -->
                <Border Background="{StaticResource SurfaceBrush}" CornerRadius="12" Padding="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock x:Name="ChatTitle" 
                                       Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‡Ð°Ñ‚Ð°" 
                                       FontSize="16" 
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextBrush}"/>
                            <TextBlock x:Name="ChatSubtitle" 
                                       Text="Online" 
                                       FontSize="12" 
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Style="{StaticResource IconButton}" 
                                    Click="AttachFileButton_Click"
                                    ToolTip="ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»">
                                <TextBlock Text="ðŸ“Ž" FontSize="18"/>
                            </Button>
                            <Button Style="{StaticResource IconButton}"
                                    Click="ChatMembersButton_Click"
                                    ToolTip="Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¸">
                                <TextBlock Text="ðŸ‘¥" FontSize="18"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
                <Border Grid.Row="1" Margin="0,12">
                    <ScrollViewer x:Name="MessagesScrollViewer" 
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="MessagesList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="0,4" 
                                            HorizontalAlignment="{Binding Alignment}"
                                            MaxWidth="500"
                                            MouseLeftButtonDown="Message_MouseLeftButtonDown"
                                            Cursor="Hand">
                                        <Border Background="{Binding Background}" 
                                                CornerRadius="12" 
                                                Padding="12,8">
                                            <StackPanel>
                                                <TextBlock Text="{Binding SenderName}" 
                                                           FontSize="12" 
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource AccentBrush}"
                                                           Visibility="{Binding SenderVisibility}"/>
                                                <ContentPresenter Content="{Binding Content, Converter={StaticResource MessageContentConverter}}"
                                                               Margin="0,2"/>
                                                <StackPanel Orientation="Horizontal" 
                                                            HorizontalAlignment="Right"
                                                            Margin="0,4,0,0">
                                                    <TextBlock Text="{Binding TimeString}" 
                                                               FontSize="10" 
                                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                    <TextBlock Text="{Binding StatusIcon}" 
                                                               FontSize="10" 
                                                               Foreground="{Binding StatusColor}"
                                                               Margin="4,0,0,0"
                                                               Visibility="{Binding StatusVisibility}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
                
                <!-- Ð’Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
                <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" CornerRadius="12" Padding="12">
                    <StackPanel>
                        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ†Ð¸Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ -->
                        <Border x:Name="QuotePanel" 
                                Visibility="Collapsed"
                                Background="{StaticResource CardBrush}"
                                CornerRadius="8"
                                Padding="10,8"
                                Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Border Width="3" Background="{StaticResource AccentBrush}" CornerRadius="2" Margin="0,0,10,0"/>
                                <StackPanel Grid.Column="1">
                                    <TextBlock x:Name="QuoteSenderName" 
                                               FontSize="12" 
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource AccentBrush}"/>
                                    <TextBlock x:Name="QuoteContent" 
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               TextTrimming="CharacterEllipsis"
                                               MaxHeight="40"/>
                                </StackPanel>
                                <Button Grid.Column="2" 
                                        Style="{StaticResource IconButton}"
                                        Click="CancelQuote_Click"
                                        ToolTip="ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ†Ð¸Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ">
                                    <TextBlock Text="âœ•" FontSize="14"/>
                                </Button>
                            </Grid>
                        </Border>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                        
                        <!-- Ð¡Ð¼Ð°Ð¹Ð»Ñ‹ -->
                        <Button Style="{StaticResource IconButton}"
                                Click="EmotesButton_Click"
                                ToolTip="Ð¡Ð¼Ð°Ð¹Ð»Ñ‹">
                            <TextBlock Text="ðŸ˜Š" FontSize="20"/>
                        </Button>
                        
                        <!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° -->
                        <TextBox x:Name="MessageInput" 
                                 Grid.Column="1"
                                 Style="{StaticResource ModernTextBox}"
                                 Margin="8,0"
                                 KeyDown="MessageInput_KeyDown"
                                 AcceptsReturn="False"/>
                        
                        <!-- ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° / ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ -->
                        <Grid Grid.Column="2" Width="40" Height="40">
                            <Button x:Name="SendButton"
                                    Style="{StaticResource PrimaryButton}"
                                    Padding="8"
                                    Width="40" Height="40"
                                    Click="SendButton_Click">
                                <TextBlock Text="âž¤" FontSize="16"/>
                            </Button>
                            
                            <!-- ÐšÑ€ÑƒÐ³Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ -->
                            <Grid x:Name="ProgressGrid" Visibility="Collapsed">
                                <Ellipse Width="36" Height="36" 
                                         Stroke="{StaticResource CardBrush}" 
                                         StrokeThickness="3"/>
                                <Path x:Name="ProgressArc" 
                                      Stroke="{StaticResource AccentBrush}" 
                                      StrokeThickness="3"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round">
                                    <Path.Data>
                                        <PathGeometry>
                                            <PathFigure x:Name="ProgressFigure" StartPoint="20,2">
                                                <ArcSegment x:Name="ProgressArcSegment" 
                                                            Size="18,18" 
                                                            SweepDirection="Clockwise"
                                                            IsLargeArc="False"
                                                            Point="20,2"/>
                                            </PathFigure>
                                        </PathGeometry>
                                    </Path.Data>
                                </Path>
                                <TextBlock x:Name="ProgressText" 
                                           Text="0%"
                                           FontSize="9"
                                           Foreground="{StaticResource TextBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Grid>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
        
        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑÐ¼Ð°Ð¹Ð»Ð¾Ð² -->
        <Popup x:Name="EmotesPopup" 
               PlacementTarget="{Binding ElementName=MessageInput}"
               Placement="Top"
               StaysOpen="False"
               AllowsTransparency="True">
            <Border Background="{DynamicResource SurfaceBrush}" 
                    CornerRadius="12" 
                    Padding="12"
                    BorderBrush="{DynamicResource CardBrush}"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" Opacity="0.3" ShadowDepth="2"/>
                </Border.Effect>
                <Grid Width="300" Height="200">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Ð¡Ð¼Ð°Ð¹Ð»Ñ‹" 
                               FontSize="14" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextBrush}"
                               Margin="0,0,0,8"/>
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <WrapPanel x:Name="EmotesPanel"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</Window>

